# Cell Painting Gallery folder structure

Here are the top-two levels of the structure

```
cellpainting-gallery/
└── <project-group>
    └── <project-specific-nesting>
```

- `<project-group>` groups together sets of related projects
- `<project-specific-nesting>` additional nesting level like what we have for s3://cellpainting-gallery/jump (one folder per partner e.g. s3://cellpainting-gallery/jump/source_4). 


Let's use Broad's data as an example to understand the full folder structure.

These are the first four levels under the bucket:

```
cellpainting-gallery
└── jump
    └── source_4
        ├── images
        └── workspace
```

- `source_4`: institution identifier (can be anything, e.g. the name of the institution)
- `images`: all the images alone (along with illumination correction functions) go here
- `workspace`: everything else goes here

Let's look under `images`:

```
└── cellpainting-gallery
    └── jump
        └── source_4
            └── images
                ├── 2021_04_26_Batch1
                │   ├── illum
                │   │   ├── BR00117035
                │   │   └── BR00117036
                │   └── images
                │       ├── BR00117035__2021-05-02T16_02_51-Measurement1
                │       └── BR00117036__2021-05-02T18_01_40-Measurement1
                └── 2021_05_31_Batch2
```

- `2021_04_26_Batch1`: this is the batch folder. It comprises all the plates that were imaged in that batch. `YYYY_MM_DD` is the date you started imaging your plates from this batch (can be approximate).
- `images`: folder containing images themselves
- `illum`: folder containing illumination correction functions
- `images/BR00117035__2021-05-02T16_02_51-Measurement1`: folder containing images for the plate `BR00117035__2021-05-02T16_02_51-Measurement1` (which, is abbreviated to `BR00117035`, except here, in the `images` folder). The structure beneath this depends on your imager, but it should essentially contain all the images from the plate, and perhaps some other related metadata.
- `illum/BR00117035`: folder containing illumination correction functions for the plate generated by CellProfiler. Here are the contents of this folder (not everyone is imaging `Brightfield` as far as I know, so you may not see those):

```
├── BR00117035
│   ├── BR00117035_IllumAGP.npy
│   ├── BR00117035_IllumBrightfield.npy
│   ├── BR00117035_IllumBrightfield_H.npy
│   ├── BR00117035_IllumBrightfield_L.npy
│   ├── BR00117035_IllumDNA.npy
│   ├── BR00117035_IllumER.npy
│   ├── BR00117035_IllumMito.npy
│   └── BR00117035_IllumRNA.npy
└── BR00117036
```

Let's look under the `workspace` folder. Everything but images live here. Here are the top-level folders under `workspace`:

```
cellpainting-gallery/
└── jump
    └── source_4
        └── workspace
            ├── analysis
            ├── backend
            ├── load_data_csv
            ├── metadata
            └── profiles
```

- `analysis`: contains the CSV files and outline PNGs generated by CellProfiler
- `backend`: contains the single-cell SQLite files (one per plate), the well-level aggregated profiles CSV files (also one per plate)
- `load_data_csv`: contains [LoadData CSV files](https://cytomining.github.io/profiling-handbook/setup-images.html#create-loaddata-csvs) used by CellProfiler to process the data
- `metadata`: contains metadata files used to annotate the profiles
- `profiles`: contains a set of well-level profiles files (one set per plate). The set comprises different stages of the CSV files produced when running the profiling recipe, as well as other output.
- `qc`: contains various QC information (one set per plate for each QC) as well as a summary folder.

Let's look under the `analysis` folder:

```
└── analysis
    ├── 2021_04_26_Batch1
    │   ├── BR00117035
    │   │   └── analysis
    │   │       ├── BR00117035-A01-1
    │   │       │   ├── Cells.csv
    │   │       │   ├── Cytoplasm.csv
    │   │       │   ├── Image.csv
    │   │       │   ├── Nuclei.csv
    │   │       │   └── outlines
    │   │       │       ├── A01_s1--cell_outlines.png
    │   │       │       └── A01_s1--nuclei_outlines.png
    │   │       └── BR00117035-A01-2
    │   └── BR00117036
    └── 2021_05_31_Batch2
```

This structure is now familiar
- `2021_04_26_Batch1` is the batch and `BR00117035` is the plate
- `analysis` is the only folder at this level; it is redundant and somewhat confusingly-named but we have kept it for legacy reasons
- `BR00117035-A01-1` is a folder containing CSV files and outline files for site `1` in well `A01` in plate `BR00117035`. You might have structured things differently. E.g. you might have grouped by well, in which case you will see `BR00117035-A01`. Or you might have a crazy big machine and be able to group by plate, in which case you will see `BR00117035`. However, you should expect the same set of CSV files under this folder as you see above. You will however see more outline files (2 if you grouped per site, 18 if you grouped per well, a gazillion if you grouped per plate).

Next, let's look under the `backend` folder:

```
└── backend
    └── 2021_04_26_Batch1
        ├── BR00117035
        │   ├── BR00117035.csv
        │   └── BR00117035.sqlite
        └── BR00117036
```

- `2021_04_26_Batch1` is the batch and `BR00117035` is the plate
- `BR00117035.sqlite` is the single-cell SQLite file, comprising all measurements from all cells in the plate.
- `BR00117035.csv` is the aggregated CSV file (aggregated per well)

Next, let's look under the `profiles` folder:

```
└── profiles
    └── 2021_04_26_Batch1
        ├── BR00117035
        │   ├── BR00117035.csv.gz
        │   ├── BR00117035_augmented.csv.gz
        │   ├── BR00117035_normalized.csv.gz
        │   ├── BR00117035_normalized_feature_select_negcon_plate.csv.gz
        │   ├── BR00117035_normalized_feature_select_plate.csv.gz
        │   ├── BR00117035_normalized_negcon.csv.gz
        │   └── <many more>
        └── BR00117036
```

- `2021_04_26_Batch1` is the batch and `BR00117035` is the plate
- The files are all produced by the [profiling-recipe](https://github.com/jump-cellpainting/profiling-recipe#files-generated).

The `load_data_csv` folder has the same structure:

```
└── load_data_csv
     └── 2021_04_26_Batch1
         ├── BR00117035
         │   ├── load_data.csv.gz
         │   └── load_data_with_illum.csv.gz
         └── BR00117036
```

The `metadata` folder has the slightly different structure, as explained in the [profiling recipe](https://github.com/cytomining/profiling-recipe#metadata-platemap-and-barcode_platemap-files)

```
└── metadata
     ├─── external_metadata
     |   └── external_metadata.tsv
     └── platemaps
         └── 2021_04_26_Batch1
             ├── platemap
             │   └── OAA01.02.03.04.A.txt
             └── barcode_platemap.csv
```


The `quality_control` folder has the slightly different structure:

```
└── quality_control
    └── heatmap
        └── 2021_04_26_Batch1
            ├── BR00117035
            │   ├── BR00117035_cell_count.png
            │   ├── BR00117035_correlation.png
            │   ├── BR00117035_position_effect.png
            │   └── and possibly others
            └── BR00117036
```

- `2021_04_26_Batch1` is the batch and `BR00117035` is the plate
- The files are all produced by the [profiling-recipe](https://github.com/jump-cellpainting/profiling-recipe#files-generated).


### Complete folder structure

Here's the complete folder structure

<details>
 <summary>Click here</summary>

```
 └── cellpainting-gallery
    └── jump
        └── source_4
            ├── images
            │   ├── 2021_04_26_Batch1
            │   │   ├── illum
            │   │   │   ├── BR00117035
            │   │   │   │   ├── BR00117035_IllumAGP.npy
            │   │   │   │   ├── BR00117035_IllumBrightfield.npy
            │   │   │   │   ├── BR00117035_IllumBrightfield_H.npy
            │   │   │   │   ├── BR00117035_IllumBrightfield_L.npy
            │   │   │   │   ├── BR00117035_IllumDNA.npy
            │   │   │   │   ├── BR00117035_IllumER.npy
            │   │   │   │   ├── BR00117035_IllumMito.npy
            │   │   │   │   └── BR00117035_IllumRNA.npy
            │   │   │   └── BR00117036
            │   │   └── images
            │   │       ├── BR00117035__2021-05-02T16_02_51-Measurement1
            │   │       └── BR00117036__2021-05-02T18_01_40-Measurement1
            │   └── 2021_05_31_Batch2
            └── workspace
                ├── analysis
                │   ├── 2021_04_26_Batch1
                │   │   ├── BR00117035
                │   │   │   └── analysis
                │   │   │       ├── BR00117035-A01-1
                │   │   │       │   ├── Cells.csv
                │   │   │       │   ├── Cytoplasm.csv
                │   │   │       │   ├── Image.csv
                │   │   │       │   ├── Nuclei.csv
                │   │   │       │   └── outlines
                │   │   │       │       ├── A01_s1--cell_outlines.png
                │   │   │       │       └── A01_s1--nuclei_outlines.png
                │   │   │       └── BR00117035-A01-2
                │   │   └── BR00117036
                │   └── 2021_05_31_Batch2
                ├── backend
                │   └── 2021_04_26_Batch1
                │       ├── BR00117035
                │       │   ├── BR00117035.csv
                │       │   └── BR00117035.sqlite
                │       └── BR00117036
                ├── load_data_csv
                │   └── 2021_04_26_Batch1
                │       ├── BR00117035
                │       │   ├── load_data.csv.gz
                │       │   └── load_data_with_illum.csv.gz
                │       └── BR00117036
                ├── metadata
                │   ├─── external_metadata
                |   |   └── external_metadata.tsv
                │   └── platemaps
                |       └── 2021_04_26_Batch1
                |           ├── platemap
                |           │   └── OAA01.02.03.04.A.txt
                |           └── barcode_platemap.csv
                ├── quality_control
                │   └── heatmap
                │       └── 2021_04_26_Batch1
                │           ├── BR00117035
                │           │   ├── BR00117035_cell_count.png
                │           │   ├── BR00117035_correlation.png
                │           │   ├── BR00117035_position_effect.png
                │           │   └── and possibly others
                │           └── BR00117036
                └── profiles
                    └── 2021_04_26_Batch1
                        ├── BR00117035
                        │   ├── BR00116991_augmented.csv.gz
                        │   ├── BR00116991_normalized.csv.gz
                        │   ├── BR00116991_normalized_feature_select_negcon_plate.csv.gz
                        │   ├── BR00116991_normalized_feature_select_plate.csv.gz
                        │   ├── BR00116991_normalized_negcon.csv.gz
                        │   ├── BR00117035.csv.gz
                        │   └── and others https://github.com/cytomining/profiling-recipe#files-generated
                        └── BR00117036
 ```
 </details>


